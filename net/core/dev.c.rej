--- net/core/dev.c
+++ net/core/dev.c
@@ -2622,6 +2624,10 @@
 	rcu_read_unlock();
 }
 
+/* The code already makes the assumption that packet handlers run
+ * sequentially on the same CPU. -Sapan */
+DEFINE_PER_CPU(int, sknid_elevator) = 0;
+
 int __netif_receive_skb(struct sk_buff *skb)
 {
 	struct packet_type *ptype, *pt_prev;
@@ -2629,8 +2635,11 @@
 	struct net_device *null_or_orig;
 	struct net_device *null_or_bond;
 	int ret = NET_RX_DROP;
+	int *cur_elevator = &__get_cpu_var(sknid_elevator);
 	__be16 type;
 
+	*cur_elevator = 0;
+
 	if (!skb->tstamp.tv64)
 		net_timestamp(skb);
 
